{
  "name": "Agente Financeiro",
  "nodes": [
    {
      "parameters": {
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.chatTrigger",
      "typeVersion": 1.3,
      "position": [
        -96,
        -128
      ],
      "id": "220adae4-a9d2-44a5-a2b7-f712ee1c8286",
      "name": "When chat message received",
      "webhookId": "f7d59753-7152-4734-9131-68be5d5ec327"
    },
    {
      "parameters": {
        "options": {
          "systemMessage": "=## Função\nVocê é meu assistente financeiro pessoal e me ajudará a organizar minhas despesas.\n\n## Tarefa\nVocê me ajudará a controlar minhas despesas e me dará dicas sobre como estou usando meu dinheiro. Para isso, você armazenará minhas despesas em um banco de dados usando as ferramentas disponíveis, com pelo menos os seguintes dados: despesa [nome_trs], valor [valor_trs], categoria [categoria] e timestamps.\n\n## Ferramentas\nVocê tem as seguintes ferramentas para obter, salvar, atualizar e excluir transações de despesas:\n- tool_view_trs: use esta ferramenta para obter uma ou mais transações do banco de dados\n- tool_create_trs: use esta ferramenta para criar uma transação de despesa no banco de dados\n- tool_update_trs: use esta ferramenta para atualizar uma transação de despesa no banco de dados. Antes de atualizar consulte quais dados atendem aos parametros, trazendo o id de cada um deles\n- tool_delete_trs: use esta ferramenta para excluir uma transação de despesa no banco de dados\n- tool_calculator: use esta ferramenta para cálculos básicos\n\n## Diretrizes\n- Seja objetivo\n- Caso o usuário não especifique a categoria da despesa, determine a categoria mais apropriada\n- Após incluir uma despesa, responda com \"Despesa de [nome], [valor] reais, registrada em [category] em {{ $now.format('dd.MM.yyyy hh:mm')}}\".\n- O valor pode ser um número ou um número com a respectiva moeda (real ou reais)\n- Sempre use a tool_calculator para qualquer cálculo que precisar\n- O usuário pode inserir dados como um número ou um número com uma moeda. Se a moeda for diferente de \"Real\" ou \"Reais\", explique ao usuário que esta versão ainda não converte moedas.\n- Remova qualquer conteúdo de metadiscurso, como introduções e conclusões típicas de assistentes de IA. Apresente apenas o conteúdo conclusivo, sem frases como \"Claro! Aqui vai uma sugestão para...\" ou \"Espero que ajude!\". Apresente apenas a mensagem pura.\n- Hoje é {{ $now }}"
        }
      },
      "type": "@n8n/n8n-nodes-langchain.agent",
      "typeVersion": 2.2,
      "position": [
        112,
        -128
      ],
      "id": "a5092db1-b7bf-49a4-a629-371491448889",
      "name": "AI Agent"
    },
    {
      "parameters": {
        "model": {
          "__rl": true,
          "value": "gpt-4.1-mini",
          "mode": "list",
          "cachedResultName": "gpt-4.1-mini"
        },
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatOpenAi",
      "typeVersion": 1.2,
      "position": [
        -320,
        96
      ],
      "id": "2c17c5a8-4f62-4090-a879-161a228bd527",
      "name": "OpenAI Chat Model",
      "credentials": {
        "openAiApi": {
          "id": "MR7r7kkAdpxqispR",
          "name": "OpenAi n8n_Dev"
        }
      }
    },
    {
      "parameters": {},
      "type": "@n8n/n8n-nodes-langchain.toolCalculator",
      "typeVersion": 1,
      "position": [
        -48,
        96
      ],
      "id": "dceb63ae-c1b9-4c14-aa28-eb7cccafb07b",
      "name": "tool_calculator"
    },
    {
      "parameters": {},
      "type": "@n8n/n8n-nodes-langchain.memoryPostgresChat",
      "typeVersion": 1.3,
      "position": [
        -176,
        96
      ],
      "id": "6cea0dbc-e7e4-4d20-b225-47a26b00a489",
      "name": "Postgres Chat Memory",
      "credentials": {
        "postgres": {
          "id": "rEtNDUIPZsYBgaRT",
          "name": "Postgres Chat Memory 2"
        }
      }
    },
    {
      "parameters": {
        "operation": "executeQuery",
        "query": "create table public.trasacoes_financeiras (\n\tid serial not null,\n\tname_trs character varying(255) not null,\n\tvalue_trs numeric(10,2) not null,\n\tcategory character varying(100) not null,\n\tdate_trs timestamp without time zone null default CURRENT_TIMESTAMP,\n\tcreated_at timestamp without time zone null default CURRENT_TIMESTAMP,\n\tupdated_at timestamp without time zone null default CURRENT_TIMESTAMP,\n\tsession_id text null,\n\tconstraint finance_trs_pkey primary key (id)\n) TABLESPACE pg_default;",
        "options": {}
      },
      "type": "n8n-nodes-base.postgres",
      "typeVersion": 2.6,
      "position": [
        800,
        16
      ],
      "id": "87ab2daf-4c14-4050-a04e-f6b2e79b4b84",
      "name": "Execute a SQL query",
      "credentials": {
        "postgres": {
          "id": "rEtNDUIPZsYBgaRT",
          "name": "Postgres Chat Memory 2"
        }
      }
    },
    {
      "parameters": {
        "operation": "getAll",
        "tableId": "trasacoes_financeiras"
      },
      "type": "n8n-nodes-base.supabaseTool",
      "typeVersion": 1,
      "position": [
        112,
        112
      ],
      "id": "f93f201d-cb8f-4053-a987-83997c191d1f",
      "name": "tool_view_trs",
      "credentials": {
        "supabaseApi": {
          "id": "uGx1r0Lg0ZgVbrzP",
          "name": "Supabase Agente Finan"
        }
      },
      "onError": "continueErrorOutput"
    },
    {
      "parameters": {
        "tableId": "trasacoes_financeiras",
        "fieldsUi": {
          "fieldValues": [
            {
              "fieldId": "name_trs",
              "fieldValue": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('fieldValues0_Field_Value', ``, 'string') }}"
            },
            {
              "fieldId": "value_trs",
              "fieldValue": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('fieldValues1_Field_Value', ``, 'string') }}"
            },
            {
              "fieldId": "category",
              "fieldValue": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('fieldValues2_Field_Value', ``, 'string') }}"
            },
            {
              "fieldId": "date_trs",
              "fieldValue": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('fieldValues3_Field_Value', ``, 'string') }}"
            }
          ]
        }
      },
      "type": "n8n-nodes-base.supabaseTool",
      "typeVersion": 1,
      "position": [
        272,
        112
      ],
      "id": "04e5329c-480f-4d8a-8aed-3e74f846f20a",
      "name": "tool_create_trs",
      "credentials": {
        "supabaseApi": {
          "id": "sfu2JaaMQMfVV8vp",
          "name": "Supabase Agente Fin"
        }
      },
      "onError": "continueErrorOutput"
    },
    {
      "parameters": {
        "operation": "update",
        "tableId": "trasacoes_financeiras",
        "filters": {
          "conditions": [
            {
              "keyName": "id",
              "condition": "eq",
              "keyValue": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('conditions0_Field_Value', ``, 'string') }}"
            }
          ]
        },
        "fieldsUi": {
          "fieldValues": [
            {
              "fieldId": "name_trs",
              "fieldValue": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('fieldValues0_Field_Value', ``, 'string') }}"
            },
            {
              "fieldId": "value_trs",
              "fieldValue": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('fieldValues1_Field_Value', ``, 'string') }}"
            },
            {
              "fieldId": "category",
              "fieldValue": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('fieldValues2_Field_Value', ``, 'string') }}"
            }
          ]
        }
      },
      "type": "n8n-nodes-base.supabaseTool",
      "typeVersion": 1,
      "position": [
        432,
        112
      ],
      "id": "573bd625-1053-4a30-a440-10969ee69316",
      "name": "tool_update_trs",
      "credentials": {
        "supabaseApi": {
          "id": "uGx1r0Lg0ZgVbrzP",
          "name": "Supabase Agente Finan"
        }
      },
      "onError": "continueErrorOutput"
    },
    {
      "parameters": {
        "operation": "delete",
        "tableId": "trasacoes_financeiras",
        "filters": {
          "conditions": [
            {
              "keyName": "id",
              "condition": "eq",
              "keyValue": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('conditions4_Field_Value', ``, 'string') }}"
            }
          ]
        }
      },
      "type": "n8n-nodes-base.supabaseTool",
      "typeVersion": 1,
      "position": [
        592,
        112
      ],
      "id": "3d1e109a-7cc6-41bc-b5f7-efefb0bb8058",
      "name": "tool_delete_trs",
      "credentials": {
        "supabaseApi": {
          "id": "uGx1r0Lg0ZgVbrzP",
          "name": "Supabase Agente Finan"
        }
      },
      "onError": "continueErrorOutput"
    },
    {
      "parameters": {},
      "type": "@n8n/n8n-nodes-langchain.toolThink",
      "typeVersion": 1.1,
      "position": [
        656,
        0
      ],
      "id": "eb04fb27-7b9d-4721-8641-41ddec5f3ce8",
      "name": "Think"
    }
  ],
  "pinData": {},
  "connections": {
    "When chat message received": {
      "main": [
        [
          {
            "node": "AI Agent",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "OpenAI Chat Model": {
      "ai_languageModel": [
        [
          {
            "node": "AI Agent",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "tool_calculator": {
      "ai_tool": [
        [
          {
            "node": "AI Agent",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "Postgres Chat Memory": {
      "ai_memory": [
        [
          {
            "node": "AI Agent",
            "type": "ai_memory",
            "index": 0
          }
        ]
      ]
    },
    "Execute a SQL query": {
      "main": [
        []
      ]
    },
    "tool_view_trs": {
      "ai_tool": [
        [
          {
            "node": "AI Agent",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ],
      "main": [
        [
          {
            "node": "AI Agent",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "tool_create_trs": {
      "ai_tool": [
        [
          {
            "node": "AI Agent",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ],
      "main": [
        [
          {
            "node": "AI Agent",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "tool_update_trs": {
      "ai_tool": [
        [
          {
            "node": "AI Agent",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ],
      "main": [
        [
          {
            "node": "AI Agent",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "tool_delete_trs": {
      "ai_tool": [
        [
          {
            "node": "AI Agent",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ],
      "main": [
        [
          {
            "node": "AI Agent",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Think": {
      "ai_tool": [
        [
          {
            "node": "AI Agent",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    }
  },
  "active": false,
  "settings": {
    "executionOrder": "v1"
  },
  "versionId": "8444a4f5-1f9d-4b6c-b25c-7479b33c4d65",
  "meta": {
    "templateCredsSetupCompleted": true,
    "instanceId": "237482541a9cd4de9c919607a3cc4e627adc9b89afc0f9efcf0e441948fe1783"
  },
  "id": "y2N482fLagyBBK58",
  "tags": [
    {
      "createdAt": "2025-06-01T04:34:17.197Z",
      "updatedAt": "2025-06-01T04:34:17.197Z",
      "id": "YLg3cGq1zLPQnlo6",
      "name": "Aula"
    },
    {
      "createdAt": "2025-06-01T04:34:11.616Z",
      "updatedAt": "2025-06-01T04:34:11.616Z",
      "id": "Lt8mXXZzhDrFC2py",
      "name": "CPDF"
    }
  ]
}